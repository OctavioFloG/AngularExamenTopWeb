<app-nav></app-nav>

<div class="dashboard-layout">
  @switch (true) {

    @case (loading) {
      <p class="dashboard-loading">Cargando datos...</p>
    }

    @case (!!errorMsg) {
      <div class="dashboard-error">
        {{ errorMsg }}
      </div>
    }

    @case (!!estudiante) {
      <section class="dashboard-card">
        <!-- Encabezado -->
        <header class="dashboard-header">
          <h2>Bienvenido, {{ estudiante.persona }}</h2>
          <p>Este es tu resumen acadÃ©mico en el Sistema Integral de InformaciÃ³n.</p>
        </header>

        <!-- Bloque de datos principales: foto izquierda + info bÃ¡sica derecha -->
        <div class="dashboard-details">
          @if (estudiante.foto) {
            <div class="details-photo">
              <img
                [src]="'data:image/jpeg;base64,' + estudiante.foto"
                alt="Foto del estudiante"
              />
            </div>
          }

          <div class="details-right">
            <p>
              <span class="label">NÃºmero de control:</span>
              <span>{{ estudiante.numero_control }}</span>
            </p>
            <p>
              <span class="label">Email institucional:</span>
              <span>{{ estudiante.email }}</span>
            </p>
            <p>
              <span class="label">Semestre actual:</span>
              <span>{{ estudiante.semestre }}</span>
            </p>
          </div>
        </div>

        <!-- Tarjetas resumen con iconos -->
        <div class="dashboard-stats-row">
          <div class="stat-card aprobado">
            <div class="stat-header">
              <span class="stat-icon">âœ…</span>
              <span class="stat-label">Materias aprobadas</span>
            </div>
            <span class="stat-value">{{ estudiante.materias_aprobadas }}</span>
          </div>

          <div class="stat-card reprobado">
            <div class="stat-header">
              <span class="stat-icon">âŒ</span>
              <span class="stat-label">Materias reprobadas</span>
            </div>
            <span class="stat-value">{{ estudiante.materias_reprobadas }}</span>
          </div>

          <div class="stat-card total">
            <div class="stat-header">
              <span class="stat-icon">ğŸ“š</span>
              <span class="stat-label">Total de materias</span>
            </div>
            <span class="stat-value">{{ estudiante.materias_cursadas }}</span>
          </div>

          <div class="stat-card creditos">
            <div class="stat-header">
              <span class="stat-icon">ğŸ“</span>
              <span class="stat-label">CrÃ©ditos acumulados</span>
            </div>
            <span class="stat-value">{{ estudiante.creditos_acumulados }}</span>
          </div>


          <div class="stat-card rep-no-acred">
            <div class="stat-header">
              <span class="stat-icon">âš ï¸</span>
              <span class="stat-label">Mat. rep. no acreditadas</span>
            </div>
            <span class="stat-value">{{ estudiante.num_mat_rep_no_acreditadas }}</span>
          </div>

          <div class="stat-card compl">
            <div class="stat-header">
              <span class="stat-icon">â•</span>
              <span class="stat-label">CrÃ©ditos complementarios</span>
            </div>
            <span class="stat-value">{{ estudiante.creditos_complementarios }}</span>
          </div>

          <div class="stat-card rep-primera">
            <div class="stat-header">
              <span class="stat-icon">â™»ï¸</span>
              <span class="stat-label">Mat. rep. (1ra oportunidad)</span>
            </div>
            <span class="stat-value">{{ estudiante.num_materias_rep_primera }}</span>
          </div>
        </div>

        <!-- Barras de progreso -->
        <div class="dashboard-progress">
          <!-- Promedio ponderado -->
          <div class="progress-block">
            <div class="progress-label">
              <span>Promedio ponderado</span>
              <span>{{ estudiante.promedio_ponderado | number:'1.2-2' }}</span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill promedio"
                [style.width.%]="(estudiante.promedio_ponderado || 0) > 100 ? 100 : estudiante.promedio_ponderado">
              </div>
            </div>
          </div>

          <!-- Promedio aritmÃ©tico -->
          <div class="progress-block">
            <div class="progress-label">
              <span>Promedio aritmÃ©tico</span>
              <span>{{ estudiante.promedio_aritmetico | number:'1.2-2' }}</span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill promedio-alt"
                [style.width.%]="(estudiante.promedio_aritmetico || 0) > 100 ? 100 : estudiante.promedio_aritmetico">
              </div>
            </div>
          </div>

          <!-- Avance de carrera -->
          <div class="progress-block">
            <div class="progress-label">
              <span>Avance de carrera</span>
              <span>{{ estudiante.porcentaje_avance }}%</span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill avance"
                [style.width.%]="estudiante.porcentaje_avance || 0">
              </div>
            </div>
          </div>

          <!-- Avance cursando -->
          <div class="progress-block">
            <div class="progress-label">
              <span>Avance cursando</span>
              <span>{{ estudiante.percentaje_avance_cursando }}%</span>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill cursando"
                [style.width.%]="estudiante.percentaje_avance_cursando || 0">
              </div>
            </div>
          </div>
        </div>
      </section>
    }
  }
</div>
